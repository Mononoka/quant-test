**Введение**

Цель анализа — реализация и оценка стратегии маркет-мейкинга на основе модели Авелланеда-Стоикова с модификацией, её сравнение с бенчмарком фиксированного спреда и изучение производительности в различных рыночных условиях. Модификация включает динамическую корректировку параметра position\_decay в зависимости от волатильности. Тестирование проводилось на синтетических данных с низкой (σ=0.01) и высокой (σ=0.05) волатильностью, с учётом задержек, вероятности исполнения, транзакционных издержек и размера тика.

**Подход**

**Синтетические данные**: Цены генерировались с помощью геометрического броуновского движения (функция generate\_synthetic\_data) с μ=0.0 для исключения трендов и фокусировки на волатильности.

- **Модель Авелланеда-Стоикова**: Реализована в методе MarketMaker.get\_quotes, вычисляющем котировки bid и ask на основе резервационной цены и спреда с учётом инвентаря, параметров γ (аверсия к риску) и κ (интенсивность ордеров).
- **Модификация**: Динамическая корректировка position\_decay пропорционально текущей волатильности (current\_vol / σ), ограниченная диапазоном [0.05, 0.5], для адаптации к рыночным условиям.
- **Бенчмарк**: Фиксированный спред (spread\_bps) с опциональной динамической корректировкой инвентаря.
- **Симуляция**: Функция run\_backtest моделирует торговлю (259200 шагов, ~3 дня) с учётом задержек (latency\_steps=0, 5, 10, 20), вероятности исполнения (execution\_prob=0.01, 0.05, 0.1), транзакционных издержек (transaction\_cost\_bps=0.5, 1.0, 2.0) и размера тика (tick\_size=0.01, 0.05, 0.1). Вероятность исполнения зависит от расстояния котировок до рыночных цен: execution\_prob \* exp(-50 \* distance).

Метрики: итоговый PnL, коэффициент Шарпа, максимальная просадка, количество сделок.

**Результаты**

Анализ охватил сценарии низкой (σ=0.01) и высокой (σ=0.05) волатильности, тестируя четыре стратегии: Avellaneda-Stoikov, Avellaneda-Stoikov Dynamic Decay, Fixed Spread Benchmark и Fixed Spread Benchmark Dynamic Decay.

**Низкая волатильность (σ=0.01)**

- **Fixed Spread Benchmark Dynamic Decay**: Лучший результат — PnL 1958.22 (execution\_prob=0.1), Шарп 0.89, просадка 1.59%. Простота фиксированного dedication to capturing bid-ask spreads and inventory adjustments minimizes risks in stable conditions.
- **Fixed Spread Benchmark**: PnL до 1866.44 (execution\_prob=0.1), просадка 2.48–22.74%. Стабильный спред обеспечивает высокий PnL при низкой волатильности.
- **Avellaneda-Stoikov**: Максимальный PnL 1103.34 (execution\_prob=0.1), Шарп до 0.44 (tick\_size=0.1), просадка 5.21–46.49%. Чувствительность к параметрам снижает эффективность без оптимизации.
- **Avellaneda-Stoikov Dynamic Decay**: PnL до 1066.42 (execution\_prob=0.1), Шарп 0.29, просадка 4.61%. Модификация снижает просадку в некоторых случаях, но уменьшает PnL из-за избыточной корректировки котировок.

**Причина**: Низкая волатильность минимизирует ценовые риски, делая фиксированный спред эффективным для захвата прибыли. Динамическая корректировка position\_decay избыточна, так как инвентарный риск низок, что приводит к чрезмерному смещению котировок и упущенным сделкам.

**Высокая волатильность (σ=0.05)**

- **Fixed Spread Benchmark**: Максимальный PnL 2016.76 (latency=0), но высокая просадка (до 85.58%, execution\_prob=0.1). Отсутствие адаптации спреда увеличивает убытки при резких ценовых движениях.
- **Fixed Spread Benchmark Dynamic Decay**: PnL до 1933.54 (execution\_prob=0.1), Шарп 0.17, просадка 13.66%. Адаптация инвентаря снижает риск, но нестабильна (PnL 15.99 при latency=0).
- **Avellaneda-Stoikov**: PnL до 1555.40 (execution\_prob=0.1), просадка 27.53–118.44%. Модель лучше управляет инвентарём, но требует калибровки для снижения просадки.
- **Avellaneda-Stoikov Dynamic Decay**: PnL до 1296.15 (execution\_prob=0.1), но высокая просадка (до 175.85%, execution\_prob=0.05) и отрицательный PnL (-155.62, latency=10). Чрезмерная корректировка котировок усиливает убытки.

**Причина**: Высокая волатильность увеличивает инвентарный риск. Модель Авелланеда-Стоикова адаптируется к риску через инвентарь, но фиксированные параметры ограничивают эффективность. Динамическая корректировка position\_decay слишком агрессивна, отдаляя котировки от рынка и увеличивая просадку.

**Влияние факторов**

- **Задержка**: Увеличение задержки (latency\_steps=20) не всегда ухудшает PnL (например, Fixed Spread Benchmark: 1185.50 при низкой волатильности). Это связано с случайным характером синтетических данных.
- **Вероятность исполнения**: Высокая вероятность (execution\_prob=0.1) увеличивает PnL (например, 1958.22 для Fixed Spread Benchmark Dynamic Decay), но повышает просадку при высокой волатильности.
- **Транзакционные издержки**: Увеличение издержек (transaction\_cost\_bps=2.0) снижает PnL, особенно для Avellaneda-Stoikov (311.07 при низкой волатильности), из-за частых сделок.
- **Размер тика**: Большой тик (tick\_size=0.1) улучшает PnL (например, 1238.01 для Avellaneda-Stoikov при высокой волатильности), снижая чувствительность к мелким колебаниям.

**Модификация и её обоснование**

Модификация заключается в динамической корректировке position\_decay на основе текущей волатильности: position\_decay = min(max(base\_position\_decay \* (current\_vol / σ), 0.05), 0.5)

**Теоретическое обоснование**: В модели Авелланеда-Стоикова инвентарь влияет на reservation\_price , смещая котировки для сокращения позиций. При высокой волатильности инвентарь становится рискованным из-за ценовых колебаний. Динамическая корректировка увеличивает смещение котировок пропорционально волатильности, снижая риск убытков.

**Почему работает/не работает**:

- **Работает при высокой волатильности и задержках**: Например, при latency\_steps=20 PnL увеличивается с 251.46 до 782.87 для Avellaneda-Stoikov Dynamic Decay, так как адаптация снижает накопление позиций в условиях нестабильности.
- **Не работает при низкой волатильности**: PnL падает с 1103.34 до 1066.42 (execution\_prob=0.1), так как низкая волатильность не требует сильной корректировки, а избыточное смещение котировок снижает вероятность исполнения.
- **Проблемы при высокой волатильности**: Чрезмерная корректировка (например, просадка 175.85% при execution\_prob=0.05) отдаляет котировки от рынка, увеличивая убытки в периоды резких движений.

**Практические вызовы**: Оценка волатильности (окно 1200 шагов) чувствительна к шуму, эмпирические границы position\_decay требуют оптимизации(пробовала оптимизировать с помощью optuna)

**Сравнение стратегий**

- **Fixed Spread Benchmark**: Высокий PnL (2016.76 при высокой волатильности, latency=0) и низкая просадка (2.48% при tick\_size=0.01, низкая волатильность). Простота спреда эффективна в стабильных условиях, но уязвима к волатильности из-за отсутствия адаптации.
- **Fixed Spread Benchmark Dynamic Decay**: Лучший PnL (1958.22, execution\_prob=0.1, низкая волатильность) и Шарп (0.89), но нестабильна при высокой волатильности (PnL 15.99, latency=0). Адаптация инвентаря снижает риск в стабильных условиях.
- **Avellaneda-Stoikov**: Устойчива при высокой волатильности (PnL 1555.40, execution\_prob=0.1), но требует оптимизации параметров. Высокая просадка (до 118.44%) ограничивает эффективность.
- **Avellaneda-Stoikov Dynamic Decay**: Улучшает производительность при задержках (PnL 782.87, latency=20, высокая волатильность), но ухудшает при низкой волатильности из-за избыточной осторожности.

**Выводы**

Модификация с динамическим position\_decay улучшает модель Авелланеда-Стоикова в условиях высокой волатильности и задержек (например, PnL с 251.46 до 782.87 при latency\_steps=20, σ=0.05), снижая риск накопления позиций за счёт адаптации котировок к волатильности. Это работает, так как усиление корректировки инвентаря минимизирует убытки от ценовых колебаний. Однако при низкой волатильности (σ=0.01) модификация снижает PnL (например, с 1103.34 до 1066.42 при execution\_prob=0.1), так как избыточное смещение котировок уменьшает вероятность исполнения, что не оправдано при низком риске.

Fixed Spread Benchmark и его модификация показывают более высокий PnL (до 2016.76 при σ=0.05, latency=0) и меньшую просадку (1.59% при σ=0.01, execution\_prob=0.1) благодаря простоте и стабильности, особенно при низкой волатильности и большом размере тика. Это объясняется эффективным захватом спреда в стабильных условиях, где сложная адаптация не требуется. Однако при высокой волатильности фиксированный спред уязвим из-за отсутствия управления рисками.

Сравнение подчёркивает, что модификация Авелланеда-Стоикова эффективна в нестабильных условиях, но требует калибровки для стабильных рынков, где бенчмарк предпочтительнее. Практические вызовы включают неточность расчёта волатильности, задержки данных и вычислительную нагрузку. Что можно сделать:

- **Optuna**: Оптимизация гиперпараметров (γ, κ, position\_decay) для максимизации Шарпа.
- **Машинное обучение**: Использование GARCH или LSTM для предсказания волатильности, повышая точность адаптации.
- **Асимметричный спред**: Учёт трендов для смещения котировок, увеличивая PnL в направленных рынках

